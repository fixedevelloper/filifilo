<?php


namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Events\TransporterPositionUpdated;

class SimulateTransporterMovement extends Command
{
    protected $signature = 'simulate:transporter {orderId}';
    protected $description = 'Simule le mouvement du transporteur pour un ordre';

    public function handle()
    {
        $orderId = $this->argument('orderId');

        // 📍 Liste de points (latitude, longitude) sur un trajet fictif
        $positions =
            [
                [4.0358791, 9.7046547],
                [4.0361718, 9.7059273],
                [4.0364646, 9.7071998],
                [4.0367573, 9.7084723],
                [4.0370501, 9.7097449],
                [4.0373428, 9.7110174],
                [4.0376355, 9.71229],
                [4.0379283, 9.7135625],
                [4.038221, 9.714835],
                [4.0385138, 9.7161076],
                [4.0388065, 9.7173801],
                [4.0390993, 9.7186526],
                [4.039392, 9.7199252],
                [4.0396847, 9.7211977],
                [4.0399775, 9.7224703],
                [4.0402702, 9.7237428],
                [4.040563, 9.7250153],
                [4.0408557, 9.7262879],
                [4.0411485, 9.7275604],
                [4.0414412, 9.7288329],
                [4.0417339, 9.7301055],
                [4.0420267, 9.731378],
                [4.0423194, 9.7326505],
                [4.0426122, 9.7339231],
                [4.0429049, 9.7351956],
                [4.0431977, 9.7364682],
                [4.0434904, 9.7377407],
                [4.0437831, 9.7390132],
                [4.0440759, 9.7402858],
                [4.0443686, 9.7415583],
                [4.0446614, 9.7428308],
                [4.0449541, 9.7441034],
                [4.0452469, 9.7453759],
                [4.0455396, 9.7466485],
                [4.0458323, 9.747921],
                [4.0461251, 9.7491935],
                [4.0464178, 9.7504661],
                [4.0467106, 9.7517386],
                [4.0470033, 9.7530111],
                [4.047296, 9.7542837],
                [4.0475888, 9.7555562],
                [4.0478815, 9.7568288],
                [4.0481743, 9.7581013],
                [4.048467, 9.7593738],
                [4.0487598, 9.7606464],
                [4.0490525, 9.7619189],
                [4.0493452, 9.7631914],
                [4.049638, 9.764464],
                [4.0499307, 9.7657365],
                [4.0502235, 9.7670091],
                [4.0505162, 9.7682816],
                [4.051055, 9.7678683]


        ];

        foreach ($positions as $pos) {
            broadcast(new TransporterPositionUpdated([
                'transporterId'=>2,
                'lat'=>$pos[0],
                'lng'=>$pos[1]]));
            $this->info("Position envoyée : {$pos[0]}, {$pos[1]}");
            sleep(2); // Pause 2 secondes pour simuler un déplacement
        }

        $this->info('Simulation terminée 🚚');
    }
}
